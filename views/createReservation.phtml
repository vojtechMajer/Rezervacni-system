<script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<table id="reservation-table">
</table>

<script>
    $(() => {
        let drahyUrl = "http://localhost/lanes";

        let reservationTable = $("table#reservation-table");
        if (reservationTable.length === 0) {
            console.log("Table not found!");
            return;
        }

        let tableHeader = $("<tr>").appendTo(reservationTable);

        // start     ..       end 
        // 8:00 8:30 .. 17:30 18:00
        let start = 8;
        let end = 18;
        let countOfTimeIntervals = end - start;

        tableHeader.append("<th> DRAHY/ČASY");

        // 2 kvůli půlhodinovým intervalům
        for (let i = 0; i <= countOfTimeIntervals; i++) {
            tableHeader.append("<th> " + String((start + i)) + ":00");
            // nebude dávat 18:30
            if (i != countOfTimeIntervals)
                tableHeader.append("<th> " + String((start + i)) + ":30");
        }

        $.getJSON(drahyUrl, function (result) {
            $.each(result, function (i, lane) {
                // lane.id(int) & lane.hasBlocks(bool)
                let laneContent = $("<tr>").appendTo(reservationTable);
                laneContent.append("<th> " + lane.id);

                for (let i = 0; i <= countOfTimeIntervals; i++) {
                    //laneContent.append('<th id="' + String(i + start) + ":" + ((i % 2 == 0) ? "00" : "30") + "," + String(lane.id) + '">VOLNO</th>');
                    laneContent.append('<th id="' + String(i + start) + "00" + lane.id + '">VOLNO</th>');
                    // nebude dávat 18:30
                    if (i != countOfTimeIntervals)
                        laneContent.append('<th id="' + String(i + start) + "30" + lane.id + '">VOLNO</th>');

                }
            });
        }).fail(function (textStatus, errorThrown) {
            console.log("Error fetching data: " + textStatus + errorThrown);
        });

        var d = new Date();
        var today = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();

        $.getJSON("http://localhost/reservations/by-day?day=" + today, function (reservations) {
            $.each(reservations, function (i, reservation) {
                console.log(reservation);

                // start time
                let Shours = Number(reservation.startDate.substring(11, 13));
                let Sminutes = reservation.startDate.substring(14, 16);

                let Ehours = Number(reservation.endDate.substring(11, 13));
                let Eminutes = reservation.endDate.substring(14, 16);

                let reservedTimes = [];

                reservedTimes.push($("table#reservation-table tr th#" + Shours + "" + Sminutes + "" + reservation.lane.id));
                reservedTimes.push($("table#reservation-table tr th#" + Ehours + "" + Eminutes + "" + reservation.lane.id));

                console.log(Shours + "" + Sminutes + "" + reservation.lane.id);
                console.log(Ehours + "" + Eminutes + "" + reservation.lane.id);

                if (Sminutes == "00") {
                    // console.log(Shours + "30" + reservation.lane.id)
                    // console.log(Shours + 1 + "00" + reservation.lane.id)
                    reservedTimes.push($("table#reservation-table tr th#" + Shours + "30" + reservation.lane.id));
                    reservedTimes.push($("table#reservation-table tr th#" + (Shours + 1) + "00" + reservation.lane.id));

                }
                for (let i = 1; i <= Ehours - Shours; i++) {
                    reservedTimes.push($("table#reservation-table tr th#" + (Shours + i) + "00" + reservation.lane.id));
                    if (i != Ehours - Shours)
                        reservedTimes.push($("table#reservation-table tr th#" + (Shours + i) + "30" + reservation.lane.id));

                    $("table#reservation-table tr th#" + (Shours + i) + "30" + reservation.lane.id);
                    // console.log(Shours + i + "30" + reservation.lane.id);
                    // pes.text("KYS");
                }

                $.each(reservedTimes, function (i, time) {
                    time.text("KYS");
                    time.css('color', 'red');
                })


                // let kys = $("table#reservation-table tr th#" + id);
                // kys.text("REZERV");

                // console.log(date);
                //   let date = new Date(reservation.startDate.substring(0, 4), reservation.startDate.substring(5, 7) - 1, reservation.startDate.substring(8, 10));
            })

        }).fail(function (textStatus, errorThrown) {
            console.log("Error fetching data: " + textStatus + errorThrown);
        });


    });
</script>